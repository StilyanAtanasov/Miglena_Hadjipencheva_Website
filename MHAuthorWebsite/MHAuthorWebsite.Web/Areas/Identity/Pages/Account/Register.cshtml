@page
@using Microsoft.AspNetCore.Authentication
@using Microsoft.AspNetCore.Mvc.TagHelpers
@using MHAuthorWebsite.Web.Utils
@model RegisterModel

@{
	ViewData["Title"] = "Регистрация";
}

@section Styles {
	<link rel="stylesheet" href="~/css/input-form.css" asp-append-version="true" />
}

<div class="page-wrapper flex-column">
	<section class="modal flex-column">
		<h1 class="title">@ViewData["Title"]</h1>
		<form class="input-form flex-column" id="registerForm" asp-route-returnUrl="@Model.ReturnUrl" method="post">
			<div asp-validation-summary="ModelOnly" role="alert" class="input-error"></div>
			<div class="form-input-box flex-column">
				<label class="form-label" asp-for="Input.Name">Име и фамилия</label>
				<input class="form-input" asp-for="Input.Name" autocomplete="name" aria-required="true" placeholder="Иван Иванов" />
				<span class="input-error" asp-validation-for="Input.Name"></span>
			</div>
			<div class="form-input-box flex-column">
				<label class="form-label" asp-for="Input.Email">Имейл адрес</label>
				<input class="form-input" asp-for="Input.Email" autocomplete="username" aria-required="true" placeholder="name@example.com" />
				<span class="input-error" asp-validation-for="Input.Email"></span>
			</div>
			<div class="form-input-box flex-column">
				<label class="form-label" asp-for="Input.Password">Парола</label>
				<input class="form-input" asp-for="Input.Password" autocomplete="new-password" aria-required="true" placeholder="password" />
				<span class="input-error" asp-validation-for="Input.Password"></span>
			</div>
			<div class="form-input-box flex-column">
				<label class="form-label" asp-for="Input.ConfirmPassword">Потвърди парола</label>
				<input class="form-input" asp-for="Input.ConfirmPassword" autocomplete="new-password" aria-required="true" placeholder="password" />
				<span class="input-error" asp-validation-for="Input.ConfirmPassword"></span>
			</div>
			<button data-trigger="load-unlimited" id="registerSubmit" type="submit" class="btn submit-btn flex-row"><i class="fa-solid fa-arrow-right-to-bracket"></i> Регистрирай се</button>

			<div class="form-box flex-column actions">
				<p>
					<a data-trigger="load-unlimited" class="link active italic" asp-page="./Login" asp-route-returnUrl="@Model.ReturnUrl">Имаш профил? Вход!</a>
				</p>
			</div>
		</form>
		
		@if ((Model.ExternalLogins?.Count ?? 0) != 0)
		{
			<div class="flex-column">
				<h3 class="subheading">Регистрация с външен акаунт</h3>
				<form id="external-account" asp-page="./ExternalLogin" asp-route-returnUrl="@Model.ReturnUrl" method="post" class="input-form flex-column">
					<div class="flex-row center">
						@foreach (AuthenticationScheme provider in Model.ExternalLogins!)
						{
							string iconPath = OAuthProviderMapper.ProviderIcons.TryGetValue(provider.Name, out string? path)
								? path
								: "";

							<button type="submit" class="btn submit-btn @(string.IsNullOrEmpty(iconPath) ? "" : "btn-none") flex-row" name="provider" value="@provider.Name" title="Регистрирай се в системата с @provider.DisplayName акаунт">
								@if (!string.IsNullOrEmpty(iconPath))
								{
									<img src="@Url.Content(iconPath)" alt="" class="icon" />
								}
								else
								{
									<span>@provider.DisplayName</span>
								}
							</button>
						}
					</div>
				</form>
			</div>
		}
	</section>
</div>

@section Scripts {
	<partial name="_ValidationScriptsPartial" />
}
